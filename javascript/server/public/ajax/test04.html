<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>/ajax/test04.html</title>
	<link rel="stylesheet" href="/css/bootstrap.css"/>
	<style>
		/* .help-block 을 일단 보이지 않게 설정 */
		#myForm .help-block{
			display: none;
		}
		/* glyphicon 을 일단 보이지 않게 설정 */
		#myForm .glyphicon{
			display: none;
		}
	</style>
</head>
<body>
<div class="container">
	<h3>회원가입 폼 입니다.</h3>
	<form action="/ajax/signup" method="post" id="myForm">
		<div class="form-group has-feedback">
			<label class="control-label" for="id">아이디</label>
			<input class="form-control" type="text" name="id" id="id"/>
			<span id="overlapErr" class="help-block">사용할 수 없는 아이디 입니다.</span>
			<span class="glyphicon glyphicon-ok form-control-feedback"></span>
		</div>

		<div class="form-group has-feedback">
			<label class="control-label" for="pwd">비밀번호</label>
			<input class="form-control" type="text" name="pwd" id="pwd"/>
			<span id="pwdRegErr" class="help-block">8글자 이상 입력하세요.</span>
			<span class="glyphicon glyphicon-ok form-control-feedback"></span>
		</div>

		<button class="btn btn-success" type="submit">가입</button>
	</form>
</div>
<script src="/js/jquery-3.2.1.js"></script>
<script>
	//아이디 입력란에 keyup 이벤트가 일어 났을때 실행할 함수 등록 
	$("#id").keyup(function(){
		//입력한 문자열을 읽어온다.
		var id=$(this).val();
		//ajax 요청을 해서 서버에 전송한다.
		$.ajax({
			method:"post",
			url:"/idCheck",
			data:{inputId:id},
			success:function(data){
				var obj=JSON.parse(data);
				if(obj.canUse){//사용 가능한 아이디 라면 
					$("#overlapErr").hide();
					//성공한 상태로 바꾸는 함수 호출
					successState("#id");
				}else{//사용 가능한 아이디가 아니라면 
					$("#overlapErr").show();
					//실패한 상태로 바꾸는 함수 호출
					errorState("#id");
				}
			}
		});
	});

	$("#pwd").keyup(function(){
		var pwd=$(this).val();
		//비밀번호를 검증할 정규 표현식
		var reg=/^.{8,}$/;
		if(reg.test(pwd)){//정규 표현식을 통과 한다면 
			$("#pwdRegErr").hide();
			//성공 상태로 바꾸기 
			successState("#pwd");

		}else{//정규 표현식을 통과 하지 못하면 
			$("#pwdRegErr").show();
			//에러 상태로 바꾸기 
			errorState("#pwd");
		}
	});

	//성공 상태로 바꾸는 함수 
	function successState(sel){
		$(sel)
		.parent()
		.removeClass("has-error")
		.addClass("has-success")
		.find(".glyphicon")
		.removeClass("glyphicon-remove")
		.addClass("glyphicon-ok")
		.show();

		$("#myForm button[type=submit]")
		.removeAttr("disabled"); 
	}
	//에러 상태로 바꾸는 함수 
	function errorState(sel){
		$(sel)
		.parent()
		.removeClass("has-success")
		.addClass("has-error")
		.find(".glyphicon")
		.removeClass("glyphicon-ok")
		.addClass("glyphicon-remove")
		.show();

		$("#myForm button[type=submit]")
		.attr("disabled","disabled"); 
	}
</script>	
</body>
</html>